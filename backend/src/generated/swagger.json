{
	"openapi": "3.0.0",
	"components": {
		"examples": {},
		"headers": {},
		"parameters": {},
		"requestBodies": {},
		"responses": {},
		"schemas": {
			"TagPublicDTO": {
				"properties": {
					"addedAt": {
						"type": "string"
					},
					"color": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"color",
					"name",
					"id"
				],
				"type": "object"
			},
			"MediaPublicDTO": {
				"properties": {
					"commentCount": {
						"type": "number",
						"format": "double"
					},
					"myRating": {
						"type": "number",
						"format": "double",
						"nullable": true
					},
					"ratingCount": {
						"type": "number",
						"format": "double"
					},
					"ratingAvg": {
						"type": "number",
						"format": "double"
					},
					"favorite": {
						"type": "boolean"
					},
					"tags": {
						"items": {
							"$ref": "#/components/schemas/TagPublicDTO"
						},
						"type": "array"
					},
					"previewUrl": {
						"type": "string",
						"nullable": true
					},
					"createdAt": {
						"type": "string"
					},
					"isExplicit": {
						"type": "boolean"
					},
					"description": {
						"type": "string",
						"nullable": true
					},
					"duration": {
						"type": "number",
						"format": "double",
						"nullable": true
					},
					"height": {
						"type": "number",
						"format": "double",
						"nullable": true
					},
					"width": {
						"type": "number",
						"format": "double",
						"nullable": true
					},
					"size": {
						"type": "number",
						"format": "double"
					},
					"contentType": {
						"type": "string"
					},
					"type": {
						"type": "string",
						"enum": [
							"IMAGE",
							"VIDEO"
						]
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"commentCount",
					"myRating",
					"ratingCount",
					"ratingAvg",
					"favorite",
					"tags",
					"previewUrl",
					"createdAt",
					"isExplicit",
					"description",
					"duration",
					"height",
					"width",
					"size",
					"contentType",
					"type",
					"id"
				],
				"type": "object"
			},
			"MediaUserDTO": {
				"allOf": [
					{
						"$ref": "#/components/schemas/MediaPublicDTO"
					},
					{
						"properties": {
							"originalUrl": {
								"type": "string",
								"nullable": true
							}
						},
						"required": [
							"originalUrl"
						],
						"type": "object"
					}
				]
			},
			"MediaModeratorDTO": {
				"allOf": [
					{
						"$ref": "#/components/schemas/MediaUserDTO"
					},
					{
						"properties": {
							"previewKey": {
								"type": "string",
								"nullable": true
							},
							"originalKey": {
								"type": "string"
							},
							"deletedBy": {
								"type": "string",
								"nullable": true
							},
							"deletedAt": {
								"type": "string",
								"nullable": true
							},
							"moderationNotes": {
								"type": "string",
								"nullable": true
							},
							"moderatedById": {
								"type": "string",
								"nullable": true
							},
							"moderatedAt": {
								"type": "string",
								"nullable": true
							},
							"moderationStatus": {
								"type": "string",
								"enum": [
									"PENDING",
									"APPROVED",
									"REJECTED"
								]
							},
							"hash": {
								"type": "string"
							}
						},
						"required": [
							"previewKey",
							"originalKey",
							"deletedBy",
							"deletedAt",
							"moderationNotes",
							"moderatedById",
							"moderatedAt",
							"moderationStatus",
							"hash"
						],
						"type": "object"
					}
				]
			},
			"MediaVisibleDTO": {
				"anyOf": [
					{
						"$ref": "#/components/schemas/MediaPublicDTO"
					},
					{
						"$ref": "#/components/schemas/MediaUserDTO"
					},
					{
						"$ref": "#/components/schemas/MediaModeratorDTO"
					}
				]
			},
			"MediaListResponseDTO": {
				"properties": {
					"nextCursor": {
						"type": "string",
						"nullable": true
					},
					"data": {
						"items": {
							"$ref": "#/components/schemas/MediaVisibleDTO"
						},
						"type": "array"
					}
				},
				"required": [
					"nextCursor",
					"data"
				],
				"type": "object"
			},
			"MediaUploadDTO": {
				"properties": {
					"createdAt": {
						"type": "string"
					},
					"moderationStatus": {
						"type": "string",
						"enum": [
							"PENDING",
							"APPROVED",
							"REJECTED"
						]
					},
					"size": {
						"type": "number",
						"format": "double"
					},
					"contentType": {
						"type": "string"
					},
					"type": {
						"type": "string",
						"enum": [
							"IMAGE",
							"VIDEO"
						]
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"createdAt",
					"moderationStatus",
					"size",
					"contentType",
					"type",
					"id"
				],
				"type": "object"
			},
			"_36_Enums.CommentDeletedKind": {
				"type": "string",
				"enum": [
					"USER",
					"MODERATOR"
				]
			},
			"CommentDeletedKind": {
				"$ref": "#/components/schemas/_36_Enums.CommentDeletedKind"
			},
			"_36_Enums.UserRole": {
				"type": "string",
				"enum": [
					"USER",
					"MODERATOR",
					"GUEST",
					"UNVERIFIED",
					"TRUSTED",
					"ADMIN"
				]
			},
			"UserRole": {
				"$ref": "#/components/schemas/_36_Enums.UserRole"
			},
			"CommentAuthorDTO": {
				"properties": {
					"role": {
						"$ref": "#/components/schemas/UserRole"
					},
					"username": {
						"type": "string"
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"role",
					"username",
					"id"
				],
				"type": "object"
			},
			"CommentDTO": {
				"properties": {
					"user": {
						"$ref": "#/components/schemas/CommentAuthorDTO"
					},
					"createdAt": {
						"type": "string"
					},
					"deletedReason": {
						"type": "string",
						"nullable": true
					},
					"deletedKind": {
						"allOf": [
							{
								"$ref": "#/components/schemas/CommentDeletedKind"
							}
						],
						"nullable": true
					},
					"isDeleted": {
						"type": "boolean"
					},
					"content": {
						"type": "string",
						"nullable": true
					},
					"parentId": {
						"type": "string",
						"nullable": true
					},
					"userId": {
						"type": "string"
					},
					"mediaId": {
						"type": "string"
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"user",
					"createdAt",
					"deletedReason",
					"deletedKind",
					"isDeleted",
					"content",
					"parentId",
					"userId",
					"mediaId",
					"id"
				],
				"type": "object"
			},
			"CommentsListResponseDTO": {
				"properties": {
					"nextCursor": {
						"type": "string",
						"nullable": true
					},
					"data": {
						"items": {
							"$ref": "#/components/schemas/CommentDTO"
						},
						"type": "array"
					}
				},
				"required": [
					"nextCursor",
					"data"
				],
				"type": "object"
			},
			"CreateCommentBodyDTO": {
				"properties": {
					"parentId": {
						"type": "string",
						"nullable": true
					},
					"content": {
						"type": "string"
					}
				},
				"required": [
					"content"
				],
				"type": "object"
			},
			"OkDTO": {
				"properties": {
					"status": {
						"type": "string",
						"enum": [
							"ok"
						],
						"nullable": false
					}
				},
				"required": [
					"status"
				],
				"type": "object"
			},
			"DeleteCommentBodyDTO": {
				"properties": {
					"reason": {
						"type": "string"
					}
				},
				"type": "object"
			},
			"UserSelfDTO": {
				"properties": {
					"isBanned": {
						"type": "boolean"
					},
					"warningCount": {
						"type": "number",
						"format": "double"
					},
					"uploadCount": {
						"type": "number",
						"format": "double"
					},
					"showUploads": {
						"type": "boolean"
					},
					"showFavorites": {
						"type": "boolean"
					},
					"showRatings": {
						"type": "boolean"
					},
					"showComments": {
						"type": "boolean"
					},
					"emailVerifiedAt": {
						"type": "string",
						"nullable": true
					},
					"updatedAt": {
						"type": "string"
					},
					"createdAt": {
						"type": "string"
					},
					"website": {
						"type": "string",
						"nullable": true
					},
					"bio": {
						"type": "string",
						"nullable": true
					},
					"avatarUrl": {
						"type": "string",
						"nullable": true
					},
					"birthDate": {
						"type": "string",
						"nullable": true
					},
					"role": {
						"$ref": "#/components/schemas/UserRole"
					},
					"email": {
						"type": "string"
					},
					"username": {
						"type": "string"
					},
					"id": {
						"type": "string"
					}
				},
				"required": [
					"isBanned",
					"warningCount",
					"uploadCount",
					"showUploads",
					"showFavorites",
					"showRatings",
					"showComments",
					"emailVerifiedAt",
					"updatedAt",
					"createdAt",
					"website",
					"bio",
					"avatarUrl",
					"birthDate",
					"role",
					"email",
					"username",
					"id"
				],
				"type": "object"
			},
			"AuthResponseDTO": {
				"properties": {
					"user": {
						"$ref": "#/components/schemas/UserSelfDTO"
					}
				},
				"required": [
					"user"
				],
				"type": "object"
			},
			"ErrorEnvelopeDTO": {
				"properties": {
					"error": {
						"properties": {
							"requestId": {
								"type": "string"
							},
							"details": {},
							"message": {
								"type": "string"
							},
							"code": {
								"type": "string"
							}
						},
						"required": [
							"code"
						],
						"type": "object"
					}
				},
				"required": [
					"error"
				],
				"type": "object"
			},
			"RegisterBodyDTO": {
				"properties": {
					"password": {
						"type": "string"
					},
					"email": {
						"type": "string"
					},
					"username": {
						"type": "string"
					}
				},
				"required": [
					"password",
					"email",
					"username"
				],
				"type": "object"
			},
			"LoginBodyDTO": {
				"properties": {
					"password": {
						"type": "string"
					},
					"email": {
						"type": "string"
					}
				},
				"required": [
					"password",
					"email"
				],
				"type": "object"
			}
		},
		"securitySchemes": {
			"cookieAuth": {
				"type": "apiKey",
				"in": "cookie",
				"name": "accessToken"
			},
			"optionalCookieAuth": {
				"type": "apiKey",
				"in": "cookie",
				"name": "accessToken"
			}
		}
	},
	"info": {
		"title": "neobooru-backend",
		"version": "0.0.1",
		"contact": {}
	},
	"paths": {
		"/media/{id}": {
			"get": {
				"operationId": "GetMedia",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/MediaVisibleDTO"
								}
							}
						}
					}
				},
				"description": "GET /media/:id\npublic, viewer-aware",
				"tags": [
					"Media"
				],
				"security": [
					{
						"optionalCookieAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "id",
						"required": true,
						"schema": {
							"type": "string"
						}
					}
				]
			}
		},
		"/media": {
			"get": {
				"operationId": "ListMedia",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/MediaListResponseDTO"
								}
							}
						}
					}
				},
				"description": "GET /media\npublic, viewer-aware",
				"tags": [
					"Media"
				],
				"security": [
					{
						"optionalCookieAuth": []
					}
				],
				"parameters": [
					{
						"in": "query",
						"name": "limit",
						"required": false,
						"schema": {
							"format": "double",
							"type": "number"
						}
					},
					{
						"in": "query",
						"name": "cursor",
						"required": false,
						"schema": {
							"type": "string"
						}
					},
					{
						"in": "query",
						"name": "sort",
						"required": false,
						"schema": {
							"type": "string"
						}
					},
					{
						"in": "query",
						"name": "type",
						"required": false,
						"schema": {
							"type": "string"
						}
					}
				]
			}
		},
		"/media/upload": {
			"post": {
				"operationId": "UploadMedia",
				"responses": {
					"201": {
						"description": "Created",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/MediaUploadDTO"
								}
							}
						}
					}
				},
				"description": "POST /media/upload\nauth required, role restricted, ban + restriction checks\n\nNOTE: multipart parsing is implemented by parseMultipartToTemp(req).\nSwagger multipart form can be added later via tsoa+multer config.",
				"tags": [
					"Media"
				],
				"security": [
					{
						"cookieAuth": []
					}
				],
				"parameters": []
			}
		},
		"/media/{id}/comments": {
			"get": {
				"operationId": "ListComments",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/CommentsListResponseDTO"
								}
							}
						}
					}
				},
				"description": "List comments for media (viewer-aware, public)\nGET /media/:id/comments",
				"tags": [
					"Comments"
				],
				"security": [
					{
						"optionalCookieAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "id",
						"required": true,
						"schema": {
							"type": "string"
						}
					},
					{
						"in": "query",
						"name": "limit",
						"required": false,
						"schema": {
							"format": "double",
							"type": "number"
						}
					},
					{
						"in": "query",
						"name": "cursor",
						"required": false,
						"schema": {
							"type": "string"
						}
					},
					{
						"in": "query",
						"name": "sort",
						"required": false,
						"schema": {
							"type": "string"
						}
					}
				]
			},
			"post": {
				"operationId": "CreateMediaComment",
				"responses": {
					"201": {
						"description": "Created",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/CommentDTO"
								}
							}
						}
					}
				},
				"description": "Create comment (auth required)\nPOST /media/:id/comments",
				"tags": [
					"Comments"
				],
				"security": [
					{
						"cookieAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "id",
						"required": true,
						"schema": {
							"type": "string"
						}
					}
				],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/CreateCommentBodyDTO"
							}
						}
					}
				}
			}
		},
		"/comments/{id}": {
			"delete": {
				"operationId": "DeleteCommentById",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OkDTO"
								}
							}
						}
					}
				},
				"description": "Soft-delete comment (owner or mod/admin)\nDELETE /comments/:id",
				"tags": [
					"Comments"
				],
				"security": [
					{
						"cookieAuth": []
					}
				],
				"parameters": [
					{
						"in": "path",
						"name": "id",
						"required": true,
						"schema": {
							"type": "string"
						}
					}
				],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/DeleteCommentBodyDTO"
							}
						}
					}
				}
			}
		},
		"/auth/register": {
			"post": {
				"operationId": "Register",
				"responses": {
					"201": {
						"description": "Created",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AuthResponseDTO"
								}
							}
						}
					},
					"400": {
						"description": "Validation error",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorEnvelopeDTO"
								},
								"examples": {
									"Example 1": {
										"value": {
											"error": {
												"code": "VALIDATION_ERROR",
												"message": "Invalid request",
												"details": {
													"issues": [
														{
															"path": [
																"email"
															],
															"message": "Invalid email"
														}
													]
												}
											}
										}
									}
								}
							}
						}
					}
				},
				"tags": [
					"Auth"
				],
				"security": [],
				"parameters": [],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/RegisterBodyDTO"
							}
						}
					}
				}
			}
		},
		"/auth/login": {
			"post": {
				"operationId": "Login",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/AuthResponseDTO"
								}
							}
						}
					},
					"400": {
						"description": "Validation error",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorEnvelopeDTO"
								},
								"examples": {
									"Example 1": {
										"value": {
											"error": {
												"code": "VALIDATION_ERROR",
												"message": "Invalid request",
												"details": {
													"issues": [
														{
															"path": [
																"email"
															],
															"message": "Invalid email"
														}
													]
												}
											}
										}
									}
								}
							}
						}
					},
					"401": {
						"description": "Invalid credentials",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorEnvelopeDTO"
								},
								"examples": {
									"Example 1": {
										"value": {
											"error": {
												"code": "INVALID_CREDENTIALS",
												"message": "Invalid email or password"
											}
										}
									}
								}
							}
						}
					}
				},
				"tags": [
					"Auth"
				],
				"security": [],
				"parameters": [],
				"requestBody": {
					"required": true,
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/LoginBodyDTO"
							}
						}
					}
				}
			}
		},
		"/auth/refresh": {
			"post": {
				"operationId": "Refresh",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OkDTO"
								}
							}
						}
					}
				},
				"tags": [
					"Auth"
				],
				"security": [],
				"parameters": []
			}
		},
		"/auth/logout": {
			"post": {
				"operationId": "Logout",
				"responses": {
					"200": {
						"description": "Ok",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/OkDTO"
								}
							}
						}
					}
				},
				"tags": [
					"Auth"
				],
				"security": [
					{
						"cookieAuth": []
					}
				],
				"parameters": []
			}
		}
	},
	"servers": [
		{
			"url": "/"
		}
	]
}